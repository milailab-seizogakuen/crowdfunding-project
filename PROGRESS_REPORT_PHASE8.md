# ğŸ¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚¡ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒˆãƒ»å®Ÿè£…é€²æ—ãƒ¬ãƒãƒ¼ãƒˆï¼ˆPhase 8 å®Œäº†ç‰ˆï¼‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚¡ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒˆï¼ˆNEXT RAILï¼‰  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0ï¼ˆ2ã‚·ãƒ¼ãƒˆç‰ˆï¼‰  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ13æ—¥  
**æ›´æ–°æ—¥**: 2025å¹´11æœˆ14æ—¥ï¼ˆPhase 8 å®Œäº†ï¼‰  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API å®Œæˆãƒ»ç’°å¢ƒè¨­å®šå®Œäº†

---

## ğŸ“Š å…¨ä½“é€²æ—

```
Phase 1: Google Sheets æº–å‚™      âœ… 100% å®Œäº†
Phase 2: Contextãƒ»çŠ¶æ…‹ç®¡ç†        âœ… 100% å®Œäº†
Phase 3: ãƒªã‚¿ãƒ¼ãƒ³é¸æŠUI           âœ… 100% å®Œäº†
Phase 4: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆUI         âœ… 100% å®Œäº†
Phase 5: éŠ€è¡ŒæŒ¯è¾¼                 ğŸ”œ 0% é–‹å§‹å¾…æ©Ÿ
Phase 6: JPYCæ±ºæ¸ˆ                 ğŸ”œ 0% é–‹å§‹å¾…æ©Ÿ
Phase 7: PayPalæ±ºæ¸ˆ               ğŸ”œ 0% é–‹å§‹å¾…æ©Ÿ
Phase 8: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API         âœ… 100% å®Œäº† â­ NEW
Phase 9: ãƒ¡ãƒ¼ãƒ«é€ä¿¡               ğŸ”œ 0% é–‹å§‹å¾…æ©Ÿ
Phase 10: ç¢ºèªãƒšãƒ¼ã‚¸              ğŸ”œ 0% é–‹å§‹å¾…æ©Ÿ

---

åˆè¨ˆé€²æ—: 60% å®Œäº†
```

---

## âœ… Phase 8: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ APIï¼ˆå®Œäº†ï¼‰

### ğŸ“‹ å®Ÿæ–½å†…å®¹

#### 1ï¸âƒ£ Google Sheets API é€£æºã®æ‹¡å¼µï¼ˆ`src/lib/googleSheets.ts`ï¼‰

**æ—¢å­˜æ©Ÿèƒ½ã®ç¢ºèª:**
- âœ… `getRewardsFromSheet()` - ãƒªã‚¿ãƒ¼ãƒ³å–å¾—
- âœ… `getDashboardFromSheet()` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å–å¾—
- âœ… `createOrder()` - æ³¨æ–‡ä½œæˆï¼ˆbacker + backing + backing_itemsï¼‰

**IDè‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½:**
- âœ… `getNextBackerId()` - B001, B002, ...
- âœ… `getNextBackingId()` - BACK001, BACK002, ...
- âœ… `getNextBackingItemId()` - BIT001, BIT002, ...

**Google Sheets æ“ä½œ:**
- âœ… `addBacker()` - backers ã‚·ãƒ¼ãƒˆã«è¿½åŠ 
- âœ… `addBacking()` - backings ã‚·ãƒ¼ãƒˆã«è¿½åŠ 
- âœ… `addBackingItems()` - backing_items ã‚·ãƒ¼ãƒˆã«è¿½åŠ 

#### 2ï¸âƒ£ API Routes ã®å®Ÿè£…

**æ—¢å­˜ API:**
- âœ… `GET /api/rewards` - ãƒªã‚¿ãƒ¼ãƒ³ä¸€è¦§å–å¾—
- âœ… `GET /api/dashboard` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å–å¾—

**æ–°è¦ API:**
- âœ… `POST /api/checkout` - **æ³¨æ–‡ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**

#### 3ï¸âƒ£ POST /api/checkout ã®ä»•æ§˜

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/app/api/checkout/route.ts`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£:**
```json
{
  "backer": {
    "name": "ç”°ä¸­å¤ªéƒ",
    "email": "tanaka@example.com",
    "phone_number": "090-1234-5678",
    "postal_code": "431-3125",
    "prefecture": "é™å²¡çœŒ",
    "city": "æµœæ¾å¸‚åŒ—åŒº",
    "address_line": "æ–°éƒ½ç”°1-2-3"
  },
  "backing": {
    "total_amount": 13000,
    "payment_method": "paypal|jpyc|bank",
    "payment_status": "pending|completed",
    "order_status": "pending|received",
    "reward_ids": ["R001", "R002"],
    "transaction_id": "optional_tx_id",
    "notes": "optional_notes"
  },
  "items": [
    {
      "reward_id": "R001",
      "quantity": 1,
      "unit_price": 3000
    }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰:**
```json
{
  "success": true,
  "data": {
    "backing_id": "BACK001",
    "backer_id": "B001",
    "total_amount": 13000,
    "payment_method": "paypal",
    "message": "Order created successfully."
  }
}
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:**
- âœ… å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç¢ºèª
- âœ… ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
- âœ… payment_method æ¤œè¨¼ (paypal / jpyc / bank)
- âœ… items é…åˆ—æ¤œè¨¼

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:**
- âœ… 400: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- âœ… 500: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼

---

## ğŸ”§ ç’°å¢ƒè¨­å®šï¼ˆå®Œäº†ï¼‰

### ğŸ“ `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `.env.local`

**è¨˜å…¥æ¸ˆã¿æƒ…å ±:**
```env
CROWDFUNDING_SHEET_ID=19ON9_FmAu6cltqm7SzXw1OcG-jC_yOJybkTIUJef8mE
CROWDFUNDING_CUSTOMER_SHEET_ID=1CrG-cAowbzyPYHC03C5B6n6h8PP-qF5CGleay2B4me4
```

**è¨­å®šå¾…ã¡ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦–ã§å¾Œã§å…¥åŠ›ï¼‰:**
- [ ] `GOOGLE_SERVICE_ACCOUNT_EMAIL`
- [ ] `GOOGLE_PRIVATE_KEY`
- [ ] `ADMIN_EMAIL`
- [ ] ãã®ä»–ï¼ˆPayPal, Gmail ãªã©ï¼‰

### ğŸ” Google Cloud Console è¨­å®š

**å®Œäº†é …ç›®:**
- âœ… Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- âœ… Google Sheets API æœ‰åŠ¹åŒ–
- âœ… ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
- âœ… JSON ã‚­ãƒ¼ç”Ÿæˆ
- âœ… Google Sheets 2ã¤ã« ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå…±æœ‰è¨­å®š

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆPhase 8 æˆæœç‰©ï¼‰

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ rewards/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts         âœ… GET /api/rewards
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts         âœ… GET /api/dashboard
â”‚   â”‚   â””â”€â”€ checkout/
â”‚   â”‚       â””â”€â”€ route.ts         âœ… POST /api/checkoutï¼ˆæ–°è¦ï¼‰
â”‚   â”œâ”€â”€ backing/
â”‚   â””â”€â”€ page.tsx                 âœ… ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Dashboard.tsx            âœ…
â”‚   â”œâ”€â”€ RewardSelector.tsx       âœ…
â”‚   â””â”€â”€ RewardCard.tsx           âœ…
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ googleSheets.ts          âœ… Google Sheets API çµ±åˆ
â””â”€â”€ types/
    â””â”€â”€ backing.ts              âœ…

.env.local                        âœ… ç’°å¢ƒå¤‰æ•°è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸš€ æ®‹ã‚Šã®ä½œæ¥­ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 5: éŠ€è¡ŒæŒ¯è¾¼ãƒ•ãƒ­ãƒ¼ï¼ˆäºˆå®šæ™‚é–“: 30åˆ†ï¼‰
- [ ] `BankTransferForm.tsx` ä½œæˆ
- [ ] æ±ºæ¸ˆæ–¹æ³•é¸æŠã®å®Ÿè£…
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆ â†’ `POST /api/checkout` ã®é€£æº

### Phase 6: JPYC æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ï¼ˆäºˆå®šæ™‚é–“: 30åˆ†ï¼‰
- [ ] `JPYCPayment.tsx` ä½œæˆ
- [ ] MetaMask æ¥ç¶š
- [ ] EIP-712 ç½²å

### Phase 7: PayPal æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ï¼ˆäºˆå®šæ™‚é–“: 45åˆ†ï¼‰
- [ ] `PayPalCheckout.tsx` ä½œæˆ
- [ ] PayPal SDK ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [ ] PayPal Buttons å®Ÿè£…

### Phase 9: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ï¼ˆäºˆå®šæ™‚é–“: 30åˆ†ï¼‰
- [ ] `emailService.ts` ä½œæˆ
- [ ] Gmail API é€£æº
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†

### Phase 10: ç¢ºèªãƒšãƒ¼ã‚¸ï¼ˆäºˆå®šæ™‚é–“: 20åˆ†ï¼‰
- [ ] `confirmation/page.tsx` ä½œæˆ
- [ ] æ”¯æ´å†…å®¹è¡¨ç¤º
- [ ] å®Œäº†ç”»é¢å®Ÿè£…

---

## ğŸ“ˆ å…¨ä½“å®Œæˆã¾ã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Phase | å†…å®¹ | çŠ¶æ…‹ | äºˆå®šæ™‚é–“ |
|-------|------|------|---------|
| 1-4 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | âœ… å®Œäº† | 140åˆ† |
| 8 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API | âœ… å®Œäº† | 40åˆ† |
| 5-7 | æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ | ğŸ”œ å¾…æ©Ÿ | 105åˆ† |
| 9 | ãƒ¡ãƒ¼ãƒ«é€ä¿¡ | ğŸ”œ å¾…æ©Ÿ | 30åˆ† |
| 10 | ç¢ºèªãƒšãƒ¼ã‚¸ | ğŸ”œ å¾…æ©Ÿ | 20åˆ† |
| **åˆè¨ˆ** | **å…¨ãƒ•ã‚§ãƒ¼ã‚º** | **60%** | **335åˆ†** |

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå®Œäº†ï¼** âœ…

æ¬¡ã®ãƒãƒ£ãƒƒãƒˆã§ **Phase 5ï¼ˆéŠ€è¡ŒæŒ¯è¾¼ãƒ•ãƒ­ãƒ¼ï¼‰** ã‚’é–‹å§‹ã—ã¾ã™ï¼ ğŸš€
